specVersion: 0.0.2
description: iExecPoCoV3
repository: https://github.com/iExecBlockchainComputing/PoCo-subgraph
schema:
  file: ./schema.graphql
dataSources:
# ================================= IexecHub ==================================
  - name: IexecHub
    kind: ethereum/contract
    network: mainnet
    source:
      address: '0xb3901d04cf645747b99dbbe8f2ee9cb41a89cebf' # hub.iexec.eth
      abi: IexecHub
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      entities:
        - Category
        - Task
        - Contribution
        - TaskInitialize
        - TaskContribute
        - TaskConsensus
        - TaskReveal
        - TaskReopen
        - TaskFinalize
        - TaskClaimed
      abis:
        - name: IexecHub
          file: node_modules/iexec-poco-interface/build/contracts/IexecHub.json
      eventHandlers:
        - event: CreateCategory(uint256,string,string,uint256)
          handler: handleCreateCategory
        - event: TaskInitialize(indexed bytes32,indexed address)
          handler: handleTaskInitialize
        - event: TaskContribute(indexed bytes32,indexed address,bytes32)
          handler: handleTaskContribute
        - event: TaskConsensus(indexed bytes32,bytes32)
          handler: handleTaskConsensus
        - event: TaskReveal(indexed bytes32,indexed address,bytes32)
          handler: handleTaskReveal
        - event: TaskReopen(indexed bytes32)
          handler: handleTaskReopen
        - event: TaskFinalize(indexed bytes32,bytes)
          handler: handleTaskFinalize
        - event: TaskClaimed(indexed bytes32)
          handler: handleTaskClaimed
      file: ./src/IexecHub/index.ts
# ================================ IexecClerk =================================
  - name: IexecClerk
    kind: ethereum/contract
    network: mainnet
    source:
      address: '0xe39859ef4ca86af6cbef798d2b805bf1a6499e8f' # clerk.iexec.eth
      abi: IexecClerk
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      entities:
        - Account
        - AppOrder
        - DatasetOrder
        - WorkerpoolOrder
        - RequesterOrder
        - Deal
        - SchedulerNotice
        - Deposit
        - Withdraw
        - Reward
        - Seize
        - Lock
        - Unlock
      abis:
        - name: IexecClerk
          file: node_modules/iexec-poco-interface/build/contracts/IexecClerk.json
      eventHandlers:
        - event: OrdersMatched(bytes32,bytes32,bytes32,bytes32,bytes32,uint256)
          handler: handleOrdersMatched
        - event: SchedulerNotice(indexed address,bytes32)
          handler: handleSchedulerNotice
        # - event: ClosedAppOrder(bytes32)
        #   handler: handleClosedAppOrder
        # - event: ClosedDatasetOrder(bytes32)
        #   handler: handleClosedDatasetOrder
        # - event: ClosedWorkerpoolOrder(bytes32)
        #   handler: handleClosedWorkerpoolOrder
        # - event: ClosedRequestOrder(bytes32)
        #   handler: handleClosedRequestOrder
        # - event : BroadcastAppOrder((address,uint256,uint256,bytes32,address,address,address,bytes32,bytes))
        #   handler: handleBroadcastAppOrder
        # - event : BroadcastDatasetOrder((address,uint256,uint256,bytes32,address,address,address,bytes32,bytes))
        #   handler: handleBroadcastDatasetOrder
        # - event : BroadcastWorkerpoolOrder((address,uint256,uint256,bytes32,uint256,uint256,address,address,address,bytes32,bytes))
        #   handler: handleBroadcastWorkerpoolOrder
        # - event : BroadcastRequestOrder((address,uint256,address,uint256,address,uint256,address,uint256,bytes32,uint256,uint256,address,address,string,bytes32,bytes))
        #   handler: handleBroadcastRequestOrder
        - event: Deposit(address,uint256)
          handler: handleDeposit
        - event: DepositFor(address,uint256,address)
          handler: handleDepositFor
        - event: Withdraw(address,uint256)
          handler: handleWithdraw
        - event: Reward(address,uint256,bytes32)
          handler: handleReward
        - event: Seize(address,uint256,bytes32)
          handler: handleSeize
        - event: Lock(address,uint256)
          handler: handleLock
        - event: Unlock(address,uint256)
          handler: handleUnlock
      file: ./src/IexecClerk/index.ts
# =============================== App registry ================================
  - name: AppRegistry
    kind: ethereum/contract
    network: mainnet
    source:
      address: '0xd4945a24566abf3517f81230ff89820c3dd39e33' # apps.iexec.eth
      abi: AppRegistry
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      entities:
        - App
      abis:
        - name: App
          file: node_modules/iexec-poco-interface/build/contracts/App.json
        - name: AppRegistry
          file: node_modules/iexec-poco-interface/build/contracts/AppRegistry.json
      eventHandlers:
        - event: CreateApp(indexed address,address)
          handler: handleCreateApp
      file: ./src/registries/index.ts
# ============================= Dataset registry ==============================
  - name: DatasetRegistry
    kind: ethereum/contract
    network: mainnet
    source:
      address: '0x1d7b69669e5781c3bce590da74ecf88da5e12a9d' # datasets.iexec.eth
      abi: DatasetRegistry
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      entities:
        - Dataset
      abis:
        - name: Dataset
          file: node_modules/iexec-poco-interface/build/contracts/Dataset.json
        - name: DatasetRegistry
          file: node_modules/iexec-poco-interface/build/contracts/DatasetRegistry.json
      eventHandlers:
        - event: CreateDataset(indexed address,address)
          handler: handleCreateDataset
      file: ./src/registries/index.ts
# ============================ Workerpool registry ============================
  - name: WorkerpoolRegistry
    kind: ethereum/contract
    network: mainnet
    source:
      address: '0x3f4c18c322064576c048b1284b700288ffef126b' # workerpool.iexec.eth
      abi: WorkerpoolRegistry
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      entities:
        - Workerpool
      abis:
        - name: Workerpool
          file: node_modules/iexec-poco-interface/build/contracts/Workerpool.json
        - name: WorkerpoolRegistry
          file: node_modules/iexec-poco-interface/build/contracts/WorkerpoolRegistry.json
      eventHandlers:
        - event: CreateWorkerpool(indexed address,indexed address,string)
          handler: handleCreateWorkerpool
      file: ./src/registries/index.ts
templates:
  - name: Workerpool
    kind: ethereum/contract
    network: mainnet
    source:
      abi: Workerpool
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.3
      language: wasm/assemblyscript
      entities:
        - Workerpool
        - PolicyChange
      abis:
        - name: Workerpool
          file: node_modules/iexec-poco-interface/build/contracts/Workerpool.json
      eventHandlers:
        - event: PolicyUpdate(uint256,uint256,uint256,uint256)
          handler: handlePolicyUpdate
      file: ./src/registries/index.ts
